# 删除服务器相关设置功能的实现计划

本文档规划如何删除设置页面中的以下 5 项服务器相关功能：

1. 「服务器功能按钮」
2. 「服务器顺序」
3. 「详情页部件顺序」
4. 「批量删除服务器」
5. 「服务器功能按钮」——这里是重复强调，实际就是第 1 项

目标是：在不破坏其它服务器相关功能的前提下，将上述功能从 UI 和逻辑上彻底移除（或最小化为“仅不再可配置”）。

---

## 一、现状梳理

### 1. Server 设置入口

- 文件： [entry.dart](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entry.dart)
- Server 页签实际内容由 `_buildServer()` 提供：
  - 所在文件： [server.dart](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L3-L17)

```dart
Widget _buildServer() {
  return Column(
    children: [
      _buildServerFuncBtns(),
      _buildNetViewType(),
      _buildServerSeq(),
      _buildServerDetailCardSeq(),
      _buildConnectionStats(),
      _buildDeleteServers(),
      _buildCpuView(),
      _buildServerMore(),
    ].map((e) => CardX(child: e)).toList(),
  );
}
```

### 2. 需要删除的 4 类入口及对应实现

1. **服务器功能按钮**
   - UI 入口：
     - `_buildServerFuncBtns()`  
       [server.dart:L122-L128](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L122-L128)
   - 具体子功能：
     - `_buildServerFuncBtnsSwitch()`（是否把服务器功能按钮移出卡片）  
       [server.dart:L130-L137](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L130-L137)
       - 依赖：`_setting.moveServerFuncs`
     - `_buildServerFuncBtnsOrder()`（服务器功能按钮排列顺序）  
       [server.dart:L139-L145](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L139-L145)
       - 跳转：`ServerFuncBtnsOrderPage.route.go(context)`

2. **服务器顺序**
   - UI 入口：`_buildServerSeq()`  
     [server.dart:L147-L153](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L147-L153)
   - 跳转：`ServerOrderPage.route.go(context)`

3. **详情页部件顺序**
   - UI 入口：`_buildServerDetailCardSeq()`  
     [server.dart:L156-L163](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L156-L163)
   - 跳转：`ServerDetailOrderPage.route.go(context)`

4. **批量删除服务器**
   - UI 入口：`_buildDeleteServers()`  
     [server.dart:L53-L84](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L53-L84)
   - 功能：
     - 读取所有 server key（`Stores.server.keys()`）
     - 弹出多选对话框选择要删除的服务器
     - 显示确认弹窗（Markdown 列出将要删除的服务器名称）
     - 调用 `Stores.server.remove(key)` 批量删除

---

## 二、整体删除策略

### 1. 删除 UI 入口，保留其它服务器设置

- 修改 `_buildServer()`：
  - 从 `children` 中移除：
    - `_buildServerFuncBtns()`
    - `_buildServerSeq()`
    - `_buildServerDetailCardSeq()`
    - `_buildDeleteServers()`
  - 保留：
    - `_buildNetViewType()`
    - `_buildConnectionStats()`
    - `_buildCpuView()`
    - `_buildServerMore()`

> 这样 Server 设置页将不再显示上述 4 个设置项，但其它服务器相关配置仍然存在。

### 2. 删除对应的构建方法及页面依赖

- 在 [server.dart](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart) 中删除以下方法：
  - `_buildDeleteServers`
  - `_buildServerFuncBtns`
  - `_buildServerFuncBtnsSwitch`
  - `_buildServerFuncBtnsOrder`
  - `_buildServerSeq`
  - `_buildServerDetailCardSeq`
- 同时，在这些方法中引用到的跳转页，属于 UI 层功能，不再对用户开放：
  - `ServerFuncBtnsOrderPage`
  - `ServerOrderPage`
  - `ServerDetailOrderPage`

> 第一阶段：仅删除上述 3 个页面的“入口”，不强制删除这些配置页面本身的代码（避免波及太大范围）。  
> 后续如果你希望进一步“瘦身代码体积”，可以再做一轮清理，把这些 Seq 相关页面和模型一并移除。

### 3. 对设置字段的处理策略

- 与上面这些 UI 强关联的 setting 字段示例：
  - `_setting.moveServerFuncs`（服务器功能按钮位置）
  - 服务器功能按钮顺序配置（应在 `ServerFuncBtnsOrderPage` 等处使用）
  - 服务器顺序（`ServerOrderPage` 相关）
  - 详情页部件顺序（`ServerDetailOrderPage` 相关）
- 计划：
  - 当前改动只 **移除配置入口**，不立即删除这些字段：
    - 避免其它页面仍在读取这些值时出现运行时错误
    - 老用户已有的配置仍然可以被读取并生效（只是不能再通过 UI 调整）
  - 如果后续确认：
    - 某些字段只被这些设置页使用，且你不再需要对应功能
    - 再做一轮“设置字段和逻辑的彻底清理”（包括 Hive 存储、默认值、使用点等）

---

## 三、具体改动步骤（实现阶段使用）

> 以下步骤用于正式实现时执行，本轮仅为规划。

### 步骤 1：修改 `_buildServer()` 的 children

- 文件： [server.dart](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart#L3-L17)
- 调整为类似：

```dart
Widget _buildServer() {
  return Column(
    children: [
      _buildNetViewType(),
      _buildConnectionStats(),
      _buildCpuView(),
      _buildServerMore(),
    ].map((e) => CardX(child: e)).toList(),
  );
}
```

效果：
- 设置页的 Server 分组中不再出现：
  - 服务器功能按钮
  - 服务器顺序
  - 详情页部件顺序
  - 批量删除服务器

### 步骤 2：删除对应构建方法

- 从 [server.dart](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entries/server.dart) 中物理删除：
  - `_buildDeleteServers` 整块 ListTile 实现
  - `_buildServerFuncBtns` 和其两个子方法 `_buildServerFuncBtnsSwitch` / `_buildServerFuncBtnsOrder`
  - `_buildServerSeq`
  - `_buildServerDetailCardSeq`

注意：
- 删除方法后，编译器会提示未使用的 import / 类型，可以借此确认是否需要继续删 import 或页面。

### 步骤 3：清理不再需要的 import

- 在 [entry.dart](file:///d:/tare%20project/flutter_server_box-1/lib/view/page/setting/entry.dart) 中：
  - 找到和 `ServerFuncBtnsOrderPage` / `ServerOrderPage` / `ServerDetailOrderPage` 相关的 import（通常在 `seq/` 目录下）
  - 如果这些页面仅被刚删除的方法使用，则可以一并删除 import
- 在按需查看 `seq` 目录下对应页面是否还有其他引用：
  - `lib/view/page/setting/seq/srv_func_seq.dart`
  - `lib/view/page/setting/seq/srv_seq.dart`
  - `lib/view/page/setting/seq/srv_detail_seq.dart`
- 如果这些页面已经没有任何引用（可以用搜索/分析确认），后续可以单独出一个“代码瘦身改动”来删除它们。

### 步骤 4：编译与静态检查

实现上述改动后，执行：

- `flutter analyze`
- 如有测试：`flutter test`

预期：
- 无编译错误
- 无未使用的 import 或变量警告（或按需处理）

### 步骤 5：手动回归验证

运行 App 后，手动验证：

1. 打开设置页面 ->「App」->「Server」分组：
   - 看不到：
     - 服务器功能按钮
     - 服务器顺序
     - 详情页部件顺序
     - 批量删除服务器
   - 仍然可以看到：
     - 网络视图类型
     - 连接统计
     - CPU 视图
     - “更多”里其它开关（字体缩放、记住密码等）
2. 服务器列表页、详情页的基本展示逻辑仍然正常：
   - 虽然暂时保留了相关排序配置的读逻辑，但用户已经无法进一步在设置里调整。

---

## 四、后续可选的进一步瘦身

如果你希望把这些功能完全从代码里清掉，可以在这轮之后另开一轮改动，主要做：

1. 删除 seq 相关页面和路由：
   - `ServerFuncBtnsOrderPage`
   - `ServerOrderPage`
   - `ServerDetailOrderPage`
2. 删除对应的设置字段与存储：
   - 包括 Hive 字段、默认值、迁移逻辑等
3. 删除服务器功能按钮在 Server 详情 / 列表中的使用代码（如果有特殊逻辑）

这一轮计划里，我们只做“设置页面上不再暴露这 4 类配置 + 不再提供批量删除入口”，尽量在功能简化和改动风险之间取得平衡。

